# Esup-Pod V5 - Backend (Detailed Context for AI Agents)

> **Note**: For high-level overview, objectives, and tech stack, see: `./llms.txt`

## Repository Structure & Modules
The project follows a Domain-Driven Design approach within `src/apps/`.

### 1. Domain Modules (`src/apps/`)
-   **`authentication/`**:
    -   Handles CAS, Shibboleth, LDAP logins.
    -   Manages JWT/Session generation for the Frontend.
-   **`video/`**:
    -   **Core Responsibility**: Managing Video objects, Metadata (title, desc), and Files.
    -   **Key Features**: Chunked Uploads, Validation, Transcoding triggers.
    -   **Workflow**: Draft -> Encoding -> Published -> Archived.
-   **`live/`**:
    -   **Core Responsibility**: Live streaming scheduling and management.
    -   **Key Features**: Event scheduling, Status updates (On Air / Off Air), Live-to-VOD conversion.
-   **`editorial/`**:
    -   **Core Responsibility**: Content organization.
    -   **Key Features**: Playlists, Channels, Themes, Disciplines.
-   **`core/`**:
    -   **Core Responsibility**: Base utilities and shared models.
    -   **Key Features**: Abstract models (TimestampedModel), custom Mixins, shared Utils.

### 2. Infrastructure (`src/services/` & `src/config/`)
-   **`src/services/`**:
    -   **EncodingClient**: Communication with the external Encoding Microservice (Celery/HTTP).
    -   **StorageService**: Abstraction for handling files (Local vs S3).
-   **`src/config/`**:
    -   Django settings, URL routing, WSGI/ASGI application entry points.

### 3. API Layer (`src/api/`)
-   **Core Responsibility**: Global API routing and schema generation.
-   **Key Features**: Swagger/OpenAPI (drf-spectacular), API Versioning.

## Functional Requirements (V5 Targets)

### A. Authentication
-   Ensure DRF works with both Session (Admin) and Token (Frontend) auth.
-   Implement strict permissions (`IsOwner`, `IsAdmin`).

### B. Video Management
-   **Upload**: Implement Robust Chunked Upload endpoint.
-   **Orchestration**: `Video` object creation -> Trigger `VideoEncode` task -> Receive Callback.

### C. Live Sequencing
-   Scheduling API for "Events".
-   Notification endpoints for Stream status.

## Reference
-   **Legacy Code**: `https://github.com/EsupPortail/Esup-Pod`
-   **Current Repo**: `https://github.com/GiorgioUtzeri/Pod_V5_Back/tree/dev_v5`

## Development
-   **Running Tests**: `make test`
